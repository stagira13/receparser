
# Receparser: レセ電パーサライブラリ

ReceparserはPythonで電子レセプトファイルを読み込むためのパーサです。  
電子レセプトファイルを読み込み、人間に読み取れる形へ変換します。  
現在は医科レセプト・DPCレセプトに対応しています。

電子レセプトファイルはこのような形をしています。

```
RE,1,1127,42806,サンプルＤＰＣ０１,1,3160822,,,,,,,1111,,,,,0,,,,,59,,,,
HO,06132013,１２３４５６７,１,5,57706,,3,2072,,,44400,,,,1080
KO,80137045,2222222,,5,57706,,,,,0,0,0
BU,110290XX99X00X,4280617,4280621,6,
SB,5849004,,,N178,01,,
SB,5849004,,,N178,11,,
SB,5849004,,,N178,21,,
SB,4280005,,,I500,31,,
SB,4280005,,,I500,41,,
SB,8843935,,,I352,42,,
SB,8836695,,,I050,43,,
KK,,,2,4280429,1,74,,,,,,,
```

とても人間に読み取れる形式ではありませんし、Pythonでそのまま扱うことも出来ません。  
`Receparser`はこれを、Pythonでも扱いやすいディクショナリ・ライクなオブジェクトに変換します。

各行の先頭に`RE`,`HO`,`SB`のようなアルファベットが付いています。これを**レコード**と呼び、その行にどのようなデータが格納されているか決めています。  
`Receparser`で読み込んだ、上記ファイルの`RE`行は以下のような形になります。

```
{'レコード識別番号': 'RE', 
'レセプト番号': '1', 
'レセプト種別': '1127',
'診療年月': '42806', 
'氏名': 'サンプルＤＰＣ０１', 
'男女区分': '1',
'生年月日': '3160822'...}
```

## Overview

### receparser.Rece
１件単位でレセプトデータを読み込み、並び順に保存したリスト構造です。ただし、**レコード**をキーにすると、ディクショナリように振る舞い、該当レコードの一覧を返します。

### receparser.MontlyRece
ファイル全体を読み込み、**カルテ番号**をキーにしたディクショナリ・ライクなオブジェクトに変換して返します。  
それぞれのキーには、対応する患者の**レセプトリスト**（`Rece`オブジェクトのリスト）が格納されます。  
（出来高レセプトでは同一月に入外の混在、DPCレセプトでは出来高・DPCの混在等で、一患者に複数レセプトが紐づくケースがあるためです）  
第一引数にはファイルを指定し、第二引数には`codes`オプションで読み込む電子レセプトの形式を指定します。  
医科レセプトの場合は`codes="ika"`、DPCレセプトの場合は`codes="dpc"`を指定して下さい。


# Usage


```python
from receparser import MonthlyRece,Rece
```


```python
# 解説用にインポートしています。
# 通常はreceparser.codesを明示的にインポートする必要はありません。
from receparser.codes import dpc_codes,ika_codes
```


```python
# 例えばdpcレセプトファイルのRE行は、このような構造です。
dpc_codes['RE']
```




    ['レコード識別番号', 'レセプト番号', 'レセプト種別', '診療年月', '氏名', '男女区分', '生年月日', '給付割合', '入院年月日', '病棟区分', '一部負担金区分', 'レセプト特記事項', None, 'カルテ番号等', '割引点数単価', None, None, None, 'レセプト総括区分', '明細情報数', '検索番号', '記録条件仕様年月情報', '請求情報', '診療科名', '診療科_人体の部位', '診療科_性別等', '診療科_医学的処置', '診療科_特定疾病']




```python
# サンプルファイルを読み込みます。
# 読み込みの際には、codesオプションに"dpc"か"ika"を指定します。
dpc = MonthlyRece('dpcsample.csv',codes="dpc")
```


```python
# .keysでカルテ番号の一覧を見ることが出来ます。
# ディクショナリのように動きます。.items(),.values()も使えます。
dpc.keys()
```




    dict_keys(['1111', '', '2222', '3333', '4444', '5555', '6666', '8888', '9999', '101010'])




```python
# レコードを指定すれば、その内容を見ることが出来ます。ディクショナリのリストが返ります。
dpc['1111'][0]['RE']
```




    [{'レコード識別番号': 'RE', 'レセプト番号': '1', 'レセプト種別': '1127', '診療年月': '42806', '氏名': 'サンプルＤＰＣ０１', '男女区分': '1', '生年月日': '3160822', '給付割合': '', '入院年月日': '', '病棟区分': '', '一部負担金区分': '', 'レセプト特記事項': '', 'カルテ番号等': '1111', '割引点数単価': '', 'レセプト総括区分': '0', '明細情報数': '', '検索番号': '', '記録条件仕様年月情報': '', '請求情報': '', '診療科名': '59', '診療科_人体の部位': '', '診療科_性別等': '', '診療科_医学的処置': '', '診療科_特定疾病': ''}]




```python
# 複数のレコードが記録されている場合は以下のようになります。
dpc['1111'][0]['SB']
```




    [{'レコード識別番号': 'SB', '傷病名コード': '5849004', '修飾語コード': '', '傷病名称': '', 'ICD10コード': 'N178', '傷病名区分': '01', '死因': '', '補足コメント': ''}, {'レコード識別番号': 'SB', '傷病名コード': '5849004', '修飾語コード': '', '傷病名称': '', 'ICD10コード': 'N178', '傷病名区分': '11', '死因': '', '補足コメント': ''}, {'レコード識別番号': 'SB', '傷病名コード': '5849004', '修飾語コード': '', '傷病名称': '', 'ICD10コード': 'N178', '傷病名区分': '21', '死因': '', '補足コメント': ''}, {'レコード識別番号': 'SB', '傷病名コード': '4280005', '修飾語コード': '', '傷病名称': '', 'ICD10コード': 'I500', '傷病名区分': '31', '死因': '', '補足コメント': ''}, {'レコード識別番号': 'SB', '傷病名コード': '4280005', '修飾語コード': '', '傷病名称': '', 'ICD10コード': 'I500', '傷病名区分': '41', '死因': '', '補足コメント': ''}, {'レコード識別番号': 'SB', '傷病名コード': '8843935', '修飾語コード': '', '傷病名称': '', 'ICD10コード': 'I352', '傷病名区分': '42', '死因': '', '補足コメント': ''}, {'レコード識別番号': 'SB', '傷病名コード': '8836695', '修飾語コード': '', '傷病名称': '', 'ICD10コード': 'I050', '傷病名区分': '43', '死因': '', '補足コメント': ''}]




```python
import pandas as pd
```


```python
# レコードに対してpandasを使えば、簡単にDataFrameやSeriesへ変換出来ます。
pd.DataFrame(dpc['1111'][0]['SB'])
```




<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ICD10コード</th>
      <th>レコード識別番号</th>
      <th>修飾語コード</th>
      <th>傷病名コード</th>
      <th>傷病名区分</th>
      <th>傷病名称</th>
      <th>死因</th>
      <th>補足コメント</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>N178</td>
      <td>SB</td>
      <td></td>
      <td>5849004</td>
      <td>01</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>N178</td>
      <td>SB</td>
      <td></td>
      <td>5849004</td>
      <td>11</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>N178</td>
      <td>SB</td>
      <td></td>
      <td>5849004</td>
      <td>21</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>I500</td>
      <td>SB</td>
      <td></td>
      <td>4280005</td>
      <td>31</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td>I500</td>
      <td>SB</td>
      <td></td>
      <td>4280005</td>
      <td>41</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>5</th>
      <td>I352</td>
      <td>SB</td>
      <td></td>
      <td>8843935</td>
      <td>42</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>6</th>
      <td>I050</td>
      <td>SB</td>
      <td></td>
      <td>8836695</td>
      <td>43</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>




```python
pd.Series(dpc['1111'][0]['RE'])
```




    カルテ番号等             1111
    レコード識別番号             RE
    レセプト特記事項               
    レセプト番号                1
    レセプト種別             1127
    レセプト総括区分              0
    一部負担金区分                
    入院年月日                  
    割引点数単価                 
    明細情報数                  
    検索番号                   
    氏名            サンプルＤＰＣ０１
    生年月日            3160822
    男女区分                  1
    病棟区分                   
    給付割合                   
    記録条件仕様年月情報             
    診療年月              42806
    診療科_人体の部位              
    診療科_医学的処置              
    診療科_性別等                
    診療科_特定疾病               
    診療科名                 59
    請求情報                   
    dtype: object




```python
# 医科ファイルの読み込みも同様です
ik = MonthlyRece('ikasample.csv',codes="ika")
```


```python
ik.keys()
```




    dict_keys(['1111', '', '2222', '5555', '666', '7777', '8888', '9999', '101010'])


# 動作環境
現在のところ、Python 3.x系の標準ライブラリのみに依存します。  
